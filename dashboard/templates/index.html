<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DEX Bot Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { font-family: Arial, sans-serif; background: #121212; color: #fff; margin: 0; padding: 0; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #1e1e1e; }
        header h1 { margin: 0; }
        header a { color: #fff; text-decoration: none; padding: 0.5rem 1rem; background: #f44336; border-radius: 4px; }
        .container { padding: 1rem; }
        button { padding: 0.4rem 0.8rem; border: none; border-radius: 4px; cursor: pointer; margin: 0.1rem; }
        .start { background: #4CAF50; color: #fff; }
        .stop { background: #f44336; color: #fff; }
        pre { background: #1e1e1e; padding: 1rem; border-radius: 8px; max-height: 400px; overflow-y: scroll; color: #0f0; }
    </style>
</head>
<body>
    <header>
        <h1>DEX Bot Dashboard</h1>
        <a href="/logout">Logout</a>
    </header>

    <div class="container">
        <h2>Welcome, {{ user['name'] }}</h2>
        <p><strong>Bot Name:</strong> {{ user['name'] }}</p>
        <p><strong>Wallet Address:</strong> {{ user['address'] }}</p>
        <p><strong>Status:</strong>
            {% if user['is_active'] %}
                <span style="color:#4CAF50">Running</span>
            {% else %}
                <span style="color:#f44336">Stopped</span>
            {% endif %}
        </p>

        <form method="get" action="/start/{{ user['id'] }}" style="display:inline;">
            <button type="submit" class="start">Start Bot</button>
        </form>
        <form method="get" action="/stop/{{ user['id'] }}" style="display:inline;">
            <button type="submit" class="stop">Stop Bot</button>
        </form>

        <h3>Logs</h3>
        <pre id="log"></pre>
    </div>

    <script>
        const logElement = document.getElementById("log");
        const uid = {{ user['id'] }};
        const evtSource = new EventSource(`/stream_logs/${uid}`);

        evtSource.onmessage = function(e) {
            logElement.innerHTML += e.data + "\n";
            logElement.scrollTop = logElement.scrollHeight;
        };

        evtSource.onerror = function() {
            console.error("SSE connection lost, attempting to reconnect...");
        };
    </script>
</body>
</html>
